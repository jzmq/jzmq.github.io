---
layout: post
title: "crawel user manual"
date: 2016-04-22 11:33:51 +0800
categories: user update
---
# 公网爬虫用户接口手册

# 1. user接口
在使用系统之前应首先创建user，获取token。然后在提交task和获取结果的时候需要带着user信息去请求接口。

## 1.1 添加user

> 请记住user及其对应的token

#### Path

```
/user
```

#### Method
POST

#### Request

    {
        "name": "Buzz",
        "description": “balabala”
    }

#### Response

    {
        "user": "Buzz",
        "token": "adfdagjldjfaefadfe"
    }

## 1.2 删除user
> 若删除成功，则返回401

```
/user?user=ec&token=adsfadkfadf
```

#### Method
DELETE

#### Response code
401

## 1.3 查询user

```
/user?user=ec&token=adlfjahsdfasf
```

#### Method
GET

#### Response

    {
        "token": "8f8e183555517df06839edda070b0672",
        "create_time": "1451370829750245", // 微秒
        "name": "ec",
        "description": "ec user"
    }

# 2. 任务接口

## 2.1 添加任务

```
/putTask
```

#### Method
Post

#### Request

    {
        "user": "ec",
        "token": "balabala",
        "url": "http://baidu.com",
        "headers": {
            "User-agent": " firefox blah blah"
        },
        "useproxy": 0,
        "interval": 86400,
        "handler": "source",
        "timeout": 30,
        "priority": 1,
        "index": 0,
        "depth": 0,
        "force": 1,
    }
    
#### Response
status code 201

	{
		"id": "balabala"，
		"status": "StStatusWaiting"
	}

#### 请求参数说明
|field|必选|类型|说明|
|:-----|:----:|:---:|---|
|user|true|string|用户名|
|token|true|string|用户token|
|url|true|string|待抓取的url|
|headers|false|json|额外的请求头|
|useproxy|false|int|取值0或1，0表示不使用代理，1表示使用代理，如无此字段则默认为0|
|interval|true|int|频控参数-控频间隔(同一任务相邻两次抓取的时间间隔)，单位：秒|
|handler|false|string|取值范围：source (默认值,网页源码);dom (用phantom将dom tree绘制完成后的body内容);snapshot (截图)|
|timeout|false|int|加载内容的超时，单位：秒|
|priority|true|int|取值范围：1，2，3；1最高|
|index|true|int|是否索引页，0不是；1是|
|depth|true|int|抓取深度|
|force|true|int|是否强制抓取，0不是，1是|


## 2.2 批量添加任务
```
/putTaskBatch
```

#### Method
Post

#### Request

    {
    	"user": "Buzz",
  		"token": "59252eccf083f2e66443a08c1e93221c",
    	"tasks": [
        	{
            	"user": "Buzz",
            	"url": "https://www.zhihu.com/question/36051571/answer/71000315",
            	"interval": 60,
            	"handler": "source",
            	"timeout": 30,
            	"priority": 1,
            	"index": 0,
            	"depth": 0,
            	"force": 0
        	},
        	{
            	"user": "Buzz",
            	"url": "https://www.zhihu.com/question/36051571/answer/71000316",
            	"interval": 60,
            	"handler": "source",
            	"timeout": 30,
            	"priority": 1,
            	"index": 0,
            	"depth": 0,
            	"force": 0
        	}
    	]
	}
    
#### Response
status code 201

	{
  		"tasks": [
    		{
      			"status": "StTaskWaiting",
      			"id": "f46d0405eb9b11e5e04199ae8e209571"
    		},
    		{
      			"status": "StTaskWaiting",
      			"id": "f46d0405eb9b11e5e04199aee1c29571"
    		}
  		]
	}



## 2.3 获取单条结果

```
/getResult?user=ec&token=balabala&id=12345
```

#### Method
GET

#### Response
status code 201

    {
        "id": "123123",
        "status": "StTaskSuccess",
        "user": "ec",
        "url": "http://t66y.com",
        "status_code": 200, //获取content内容时的状态码。
        "headers": {}, //网页返回的头部
        "content": "blah blah", //网页源代码，zlib压缩+base64
        "time": 1431938423, //抓取页面时的时间戳，精确到毫秒
        "elapse": 5123, //从收到任务到抓取结束的耗时，精确到毫秒
        "depth": 1
    }

## 2.4 获取流式结果
> 每次请求默认获取100条结果

```
/getStreamResults?user=ec&token=balabala
```
#### Method
GET

#### Parameter
size：获取条数。可选参数

#### Response
status code 201

    [
    	{
        	"id": "123123",
        	"status": "StTaskSuccess",
        	"user": "ec",
        	"url": "http://t66y.com", //抓取的网页url
        	"status_code": 200, //获取content内容时的状态码。
        	"headers": {}, //网页返回的头部
        	"content": "blah blah", //网页源代码，zlib压缩+base64
        	"time": 1431938423, //抓取页面时的时间戳，精确到毫秒
        	"elapse": 5123, //从收到任务到抓取结束的耗时，精确到毫秒
        	"depth": 1
    	},
    	{...},
    	...
    ]

## 2.5 删除任务

```
/delTask?user=ec&token=balabala&id=adjfdjfjd
```

#### Method
DELETE

#### Response
status code 204


# 3. 说明

1. 目前系统仅用于功能测试，还未经过大规模的性能测试。
2. 目前版本还未支持使用代理功能。
3. Task的有效时间为1小时。

